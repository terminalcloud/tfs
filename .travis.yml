language: rust

env:
    global:
        # Use in deploy
        - PROJECT_NAME=tfs

# Specify all of our different build configs.
matrix:
    # Clear defaults
    exclude:
        - osx
        - linux

    # Our actual builds
    include:
        # Cross Compiles:
        - os: linux
          env: TARGET=i686-unknown-linux-gnu
          rust: stable # Only cross-compile from stable
          addons:
            apt:
              packages:
                # Cross compiler and cross compiled C libraries
                - gcc-multilib
                - libfuse-dev
        - os: osx
          env: TARGET=i686-apple-darwin
          rust: stable # Only cross-compile from stable

        # Native compiles:

        # Linux x86_64-unknown-linux-gnu
        - os: linux
          env: TARGET=x86_64-unknown-linux-gnu
          rust: stable
          addons:
            apt:
              packages:
                - libfuse-dev
        - os: linux
          env: TARGET=x86_64-unknown-linux-gnu
          rust: beta
          addons:
            apt:
              packages:
                - libfuse-dev
        - os: linux
          env: TARGET=x86_64-unknown-linux-gnu
          rust: nightly
          addons:
            apt:
              packages:
                - libfuse-dev

        # Linux x86_64-unknown-linux-musl
        - os: linux
          env: TARGET=x86_64-unknown-linux-musl
          rust: stable
          addons:
            apt:
              packages:
                - libfuse-dev
        - os: linux
          env: TARGET=x86_64-unknown-linux-musl
          rust: beta
          addons:
            apt:
              packages:
                - libfuse-dev
        - os: linux
          env: TARGET=x86_64-unknown-linux-musl
          rust: nightly
          addons:
            apt:
              packages:
                - libfuse-dev

        # OS X x86_64-apple-darwin
        - os: osx
          rust: stable
          env: TARGET=x86_64-apple-darwin
        - os: osx
          rust: beta
          env: TARGET=x86_64-apple-darwin
        - os: osx
          rust: nightly
          env: TARGET=x86_64-apple-darwin


# Install FUSE on OS X
install:
    - bash ci/install.sh

before_deploy:
    - bash ci/before_deploy.sh

script:
    - bash ci/script.sh

deploy:
    provider: releases
    api_key:
        secure: "PYyqe9K1L6zYEeKvHbmlvDwzS+MJ6GrAT5s1OU+1jTpulffqskpVRdWhZvP3kCa1r1TJJCCdm9TmggwavzzMRghRc4dkS6zIBhig/SEAnwUcaC0MPiuUeDyRqPflbTKfxaSOKoiBfxkHUgUzCrcM4QPeq6wpx/VdxhOpazoVg7lBeYHQTZsceUd4PnPsONN1hVZFVAYgooxYzX11edMcR9sNw1ypBvAM03DO5Bc9a+sCLBiDQ2Yv3MtLB+/6FFvypyIsb5ZEY6XKtWcaxTQZV6e0BbyOVmHElzDN95rU4FLRSvdur5QoUnZUnZpMKXVsIejtfS86bRklzNvyDKMdcjngloX8Hs8rvdp/KbubperjRFTa5daoeyMcuH0ZMISF63GlAMf/coJXoInY5HYOnGtoBtuy4ky2WcsVblfh4VAE1lHBrW/Fn1u6FE7cnX310Q/3Zwk5LcrPSSMiX3na9iv8I1scc98GWeShYBIzeEkBmrP8+L3OmeaK9K+/TVkdkBFQwvSFEJOFfC0hs3OHSxJ36eZg83msTSq+ikZwwx5o9NGrqzhvgG68roGNV2DsmDEKUxBCJgZlnRhsqlu+aWEUJAGJZvkZSgz6jkqp+AOKjlfoZ0BeWTdRGzO+buQcPgbXW3ehVTU5DFt8OQfEz52zOLky3KsT/1pQqYJWndQ="
    file: ${PROJECT_NAME}-${TRAVIS_TAG}-${TARGET}.tar.gz
    skip_cleanup: true
    on:
        branch: master
        tags: true

